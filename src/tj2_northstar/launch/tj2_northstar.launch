<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="apriltag_settings" default="$(find tj2_bringup)/config/diffyjr/tags/settings.yaml"/>
    <arg name="apriltag_tags" default="$(find tj2_bringup)/config/diffyjr/tags/3-101_tags.yaml"/>
    <arg name="publish_tag_detections_image" default="false"/>
    <arg name="filter_params" default="$(find tj2_bringup)/config/diffyjr/northstar/filter.yaml"/>
    <arg name="common_camera_params" default="$(find tj2_bringup)/config/diffyjr/northstar/ov2311.yaml"/>
    <arg name="camera_0_info_url" default="package://tj2_bringup/config/diffyjr/northstar/calibration/camera_0.yaml"/>
    <arg name="camera_1_info_url" default="package://tj2_bringup/config/diffyjr/northstar/calibration/camera_1.yaml"/>

    <group ns="northstar">
        <rosparam command="load" file="$(arg filter_params)" ns=""/>

        <node pkg="tj2_northstar" type="tj2_northstar_filter.py" name="tj2_northstar" output="screen">
            <remap from="odom" to="/tj2/odom" />
            <remap from="amcl_pose" to="/amcl_pose" />
            <remap from="initialpose" to="/initialpose"/>
        </node>

        <node pkg="tj2_northstar" type="landmark_converter.py" name="landmark_converter" required="false" output="screen"/>
        <node pkg="tj2_northstar" type="amcl_tag_initialization.py" name="amcl_tag_initialization" required="false" output="screen">
            <remap from="amcl_pose" to="/amcl_pose"/>
            <remap from="odom" to="/tj2/odom"/>
            <remap from="initialpose" to="/initialpose"/>
            <param name="cooldown_time" value="1.0"/>
        </node>

        <include file="$(find tj2_northstar)/launch/dual_camera.launch">
            <arg name="common_camera_params" value="$(arg common_camera_params)"/>
            <arg name="camera_0_info_url" value="package://tj2_bringup/config/diffyjr/northstar/calibration/camera_0.yaml"/>
            <arg name="serial_0" value="UC621"/>
            <arg name="name_0" value="camera_0"/>

            <arg name="camera_1_info_url" value="package://tj2_bringup/config/diffyjr/northstar/calibration/camera_1.yaml"/>
            <arg name="serial_1" value="UC622"/>
            <arg name="name_1" value="camera_1"/>
        </include>

        <include file="$(find tj2_northstar)/launch/apriltag_single_cam.launch">
            <arg name="apriltag_settings" value="$(arg apriltag_settings)"/>
            <arg name="apriltag_tags" value="$(arg apriltag_tags)"/>
            <arg name="node_name" value="apriltag_camera_0"/>
            <arg name="camera_info_topic" value="camera_0/camera_info"/>
            <arg name="image_rect_topic" value="camera_0/image_raw"/>
        </include>
        <include file="$(find tj2_northstar)/launch/apriltag_single_cam.launch">
            <arg name="apriltag_settings" value="$(arg apriltag_settings)"/>
            <arg name="apriltag_tags" value="$(arg apriltag_tags)"/>
            <arg name="node_name" value="apriltag_camera_1"/>
            <arg name="camera_info_topic" value="camera_1/camera_info"/>
            <arg name="image_rect_topic" value="camera_1/image_raw"/>
        </include>
    </group>
</launch>
