<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <param name="use_sim_time" value="true"/>
    <arg name="map_name" default="map-{date}"/>
    <arg name="bag_name" default=""/>
    <arg name="mode" default="mapping"/> <!-- "mapping", "localize", or "idle" -->
    <node if="$(eval len(bag_name) > 0)" pkg="rosbag" type="play" name="player" output="screen" args="--pause --clock /root/bags/$(arg bag_name)"/>

    <node pkg="tj2_laser_slam" type="odom_bag_publisher.py" name="odom_bag_publisher" output="screen">
        <remap from="odom" to="/tj2/odom"/>
    </node>
    <group ns="laser">
        <node pkg="laser_filters" type="scan_to_scan_filter_chain" name="laser_filter">
            <rosparam command="load" file="$(find tj2_bringup)/config/diffyjr/laser_filter.yaml" />
        </node>
    </group>
    <include file="$(find tj2_description)/launch/tj2_description.launch">
        <arg name="model" value="$(find tj2_description)/urdf/diffyjr.urdf.xml"/>
        <arg name="joint_names" value="$(find tj2_bringup)/config/diffyjr/joints.yaml"/>
    </include>

    <include file="$(find tj2_laser_slam)/launch/tj2_laser_slam.launch">
        <arg name="mode" value="$(arg mode)"/>
        <!-- <arg name="mode" value="idle"/> -->
        <arg name="map_name" value="$(arg map_name)"/>
        <arg name="laser_scan_topic" value="/laser/scan_filtered"/>
        <arg name="gmapping_config" value="$(find tj2_bringup)/config/diffyjr/gmapping.yaml"/>
        <arg name="amcl_config" value="$(find tj2_bringup)/config/diffyjr/amcl.yaml"/>
    </include>

    <node pkg="tf" type="static_transform_publisher" name="base_link_to_base_tilt" args="0.0 0.0 0.0  0 0 0 1 base_link base_tilt_link 20" />
    <node pkg="tf" type="static_transform_publisher" name="base_link_to_camera_tilt" args="0.2032 0.0 0.254  0 0 0 1 base_tilt_link camera_tilt_link 20" />
    <node pkg="tf" type="static_transform_publisher" name="camera_armature_to_link" args="0.0 0.0 0.0  0 0 0 1 camera_armature_link camera_link 20" />
    <node pkg="tf" type="static_transform_publisher" name="base_tilt_link_to_laser" args="-0.0553 0.116 0.253  0 0 1 0 base_tilt_link laser 20" />
    <node pkg="tf" type="static_transform_publisher" name="base_tilt_link_to_imu" args="0.0634 0.0012 0.2039  0.0000  0.0000  0.7071  0.7071 base_tilt_link imu 33" />
    <node pkg="tf" type="static_transform_publisher" name="base_tilt_link_to_limelight" args="0.2182 0.0 0.2188  0.0 0.0 0.0 1.0 base_tilt_link limelight_link 33" />

</launch>
