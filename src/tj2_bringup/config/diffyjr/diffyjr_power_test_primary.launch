<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="yolo_class_names" value="$(find tj2_yolo)/models/charged_up_2023.names" />
    <arg name="yolo_model_path" value="$(find tj2_yolo)/models/charged_up_2023-02-25.torchscript" />
    <arg name="laser_scan_topic" value="/laser/scan_filtered" />
    <arg name="map_name" default="$(env ROS_MAP_NAME)" />
    <arg name="robot" default="$(env ROBOT)" />

    <include file="$(find tj2_camera)/launch/tj2_zed2.launch">
        <arg name="yolo_model_path" value="$(arg yolo_model_path)" />
        <arg name="yolo_class_names_path" value="$(arg yolo_class_names)" />
        <arg name="serial_number" value="25556416" />
    </include>
    <include file="$(find tj2_yolo)/launch/tj2_yolo.launch">
        <arg name="yolo_model_path" value="$(arg yolo_model_path)" />
        <arg name="yolo_class_names_path" value="$(arg yolo_class_names)" />
    </include>
    <include file="$(find tj2_charged_up)/launch/charged_up_perception.launch" />

    <group ns="laser">
        <include file="$(find tj2_rplidar)/launch/tj2_rplidar_a2.launch">
            <arg name="serial_port"
                value="/dev/serial/by-id/usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0" />
            <arg name="lidar_node_name" value="$(arg robot)_rplidar" />
            <arg name="laser_frame_id" value="laser" />
        </include>

        <node pkg="laser_filters" type="scan_to_scan_filter_chain" name="laser_filter">
            <rosparam command="load"
                file="$(find tj2_bringup)/config/$(arg robot)/laser_filter.yaml" />
        </node>
    </group>

    <include file="$(find tj2_laser_slam)/launch/tj2_laser_slam.launch">
        <arg name="mode" value="localize" />
        <arg name="map_name" value="$(arg map_name)" />
        <arg name="laser_scan_topic" value="$(arg laser_scan_topic)" />
        <arg name="gmapping_config" value="$(find tj2_bringup)/config/$(arg robot)/gmapping.yaml" />
        <arg name="amcl_config" value="$(find tj2_bringup)/config/$(arg robot)/amcl.yaml" />
    </include>

    <include file="$(find tj2_northstar)/launch/tj2_northstar.launch">
        <arg name="filter_params"
            value="$(find tj2_bringup)/config/$(arg robot)/northstar/filter.yaml" />
        <arg name="tag_params"
            value="$(find tj2_bringup)/config/$(arg robot)/tags/$(arg map_name)_tags.yaml" />
    </include>

    <include file="$(find tj2_northstar)/launch/dual_camera.launch">
        <arg name="common_camera_params"
            value="$(find tj2_bringup)/config/$(arg robot)/northstar/ov2311.yaml" />
        <arg name="camera_0_info_url"
            value="package://tj2_bringup/config/$(arg robot)/northstar/calibration/camera_0.yaml" />
        <arg name="serial_0" value="UC621" />
        <arg name="name_0" value="camera_0" />

        <arg name="camera_1_info_url"
            value="package://tj2_bringup/config/$(arg robot)/northstar/calibration/camera_1.yaml" />
        <arg name="serial_1" value="UC622" />
        <arg name="name_1" value="camera_1" />
    </include>

    <include file="$(find tj2_northstar)/launch/apriltag_dual_cam.launch">
        <arg name="apriltag_settings"
            value="$(find tj2_bringup)/config/$(arg robot)/tags/settings.yaml" />
        <arg name="apriltag_tags"
            value="$(find tj2_bringup)/config/$(arg robot)/tags/$(arg map_name)_tags.yaml" />
    </include>
</launch>