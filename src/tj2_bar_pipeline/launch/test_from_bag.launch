<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <param name="use_sim_time" value="true"/>
    <arg name="bag_name" default=""/>
    <!-- <include file="$(find tj2_bar_pipeline)/launch/tj2_bar_pipeline.launch"/> -->
    <include file="$(find tj2_bar_pipeline)/launch/tj2_bar_pipeline_py.launch"/>
    <!-- <include file="$(find tj2_climber_pipeline)/launch/tj2_climber_pipeline.launch"/> -->

    <include file="$(find tj2_description)/launch/basic_transforms.launch"/>
    <node name="camera_bag" pkg="rosbag" type="play" output="log" args="$(find tj2_camera)/bags/$(arg bag_name) --clock --loop"/>

    <node pkg="tj2_laser_slam" type="odom_bag_publisher.py" name="odom_bag_publisher" output="screen">
        <param name="x_scale" value="-0.3048"/>
        <param name="y_scale" value="-0.3048"/>
        <param name="z_scale" value="-0.3048"/>
        <remap from="odom" to="/tj2/odom"/>
    </node>

    <node pkg="tf" type="static_transform_publisher" name="depth_to_camera" args="0 0 0  0.500, -0.500, 0.500, 0.500 camera_link camera_depth_optical_frame 100" />
    <node pkg="tf" type="static_transform_publisher" name="color_to_camera" args="0 0 0  0.500, -0.500, 0.500, 0.500 camera_link camera_color_optical_frame 100" />

    <group ns="camera">
        <node pkg="nodelet" type="nodelet" args="manager" name="post_processing_manager" output="screen"/>
        <node pkg="nodelet" type="nodelet" name="points_xyzrgb_sw_registered"
                args="load depth_image_proc/point_cloud_xyzrgb post_processing_manager" respawn="false">
            <remap from="rgb/image_rect_color"        to="color/image_raw" />
            <remap from="rgb/camera_info"             to="color/camera_info" />
            <remap from="depth_registered/image_rect" to="aligned_depth_to_color/image_raw" />
        </node>
    </group>

    <node name="bar_image_viewer" pkg="rqt_image_view" type="rqt_image_view" output="screen" args="/tj2/bar_pipeline_debug/image_raw"/>
    <!-- <node name="climber_image_viewer" pkg="rqt_image_view" type="rqt_image_view" output="screen" args="/tj2/climber_pipeline_debug/image_raw"/> -->
</launch>
